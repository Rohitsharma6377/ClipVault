<Page
    x:Class="ClipVault.Views.ClipboardListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:u="using:ClipVault.Models"
    xmlns:vm="using:ClipVault.ViewModels"
    x:Name="PageRoot">

    <Grid>
        <!-- Background Layer -->
        <!-- Using ThemeResource for safety but opacity for glass feel -->
        <Border Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="12" Margin="8" Opacity="0.5"/>
        
        <ListView ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
                  SelectionMode="None"
                  Padding="16"
                  IsItemClickEnabled="False">
            
            <ListView.ItemContainerTransitions>
                <TransitionCollection>
                    <AddDeleteThemeTransition />
                    <ContentThemeTransition />
                    <ReorderThemeTransition />
                </TransitionCollection>
            </ListView.ItemContainerTransitions>
            
            <ListView.ItemContainerStyle>
                 <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="0,0,0,8" />
                    <Setter Property="Margin" Value="0,4,0,4" />
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="u:ClipboardItem">
                    <Grid CornerRadius="12" 
                          Padding="12" 
                          BorderThickness="1"
                          BorderBrush="#11FFFFFF"
                          Background="{StaticResource GlassCardBackgroundBrush}">
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Spacing="4" VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind Preview}" 
                                       FontWeight="Medium"
                                       FontSize="14"
                                       MaxLines="2" 
                                       TextTrimming="CharacterEllipsis" 
                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8" Opacity="0.7">
                                <TextBlock Text="{x:Bind TimestampDisplay}" 
                                           FontSize="11" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                
                                <FontIcon Glyph="&#xE735;" FontFamily="Segoe MDL2 Assets" FontSize="12" 
                                          Foreground="{ThemeResource SystemAccentColor}"
                                          Visibility="{x:Bind IsPinned, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2" VerticalAlignment="Center" Margin="8,0,0,0">
                            <!-- Copy -->
                            <Button Click="CopyButton_Click" ToolTipService.ToolTip="Copy" Style="{StaticResource GradientIconButtonStyle}">
                                <SymbolIcon Symbol="Copy" />
                            </Button>
                            
                            <!-- Toggle Pin -->
                            <ToggleButton Click="PinButton_Click" IsChecked="{x:Bind IsPinned, Mode=OneWay}" ToolTipService.ToolTip="Pin" Style="{StaticResource GradientIconToggleButtonStyle}">
                                <SymbolIcon Symbol="Pin" />
                            </ToggleButton>
                            
                            <!-- Delete -->
                            <Button Click="DeleteButton_Click" ToolTipService.ToolTip="Delete" Style="{StaticResource GradientIconButtonStyle}">
                                <SymbolIcon Symbol="Delete" Foreground="Red"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        
        <ProgressRing IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" 
                      HorizontalAlignment="Center" VerticalAlignment="Center" 
                      Width="40" Height="40" />
    </Grid>
</Page>
