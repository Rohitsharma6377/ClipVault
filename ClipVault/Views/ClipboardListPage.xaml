<Page
    x:Class="ClipVault.Views.ClipboardListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:u="using:ClipVault.Models"
    xmlns:vm="using:ClipVault.ViewModels"
    xmlns:helpers="using:ClipVault.Helpers">

    <Page.Resources>
        <helpers:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="16,12,16,4">
            <TextBlock x:Name="HeaderTitle" 
                       Text="Clipboard History" 
                       Style="{StaticResource SubtitleTextBlockStyle}" 
                       VerticalAlignment="Center"/>
            
            <Button Command="{x:Bind ViewModel.ClearAllCommand}" 
                    Content="Clear All" 
                    HorizontalAlignment="Right" 
                    Style="{StaticResource AccentButtonStyle}"
                    CornerRadius="8" />
        </Grid>

        <!-- Background Layer -->
        <Border Grid.Row="1" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="12" Margin="8,0,8,8" Opacity="0.5"/>
        
        <ListView Grid.Row="1" 
                  ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
                  SelectionMode="None"
                  Padding="16,8,16,16"
                  IsItemClickEnabled="False">
            
            <ListView.ItemContainerTransitions>
                <TransitionCollection>
                    <AddDeleteThemeTransition />
                    <ContentThemeTransition />
                    <ReorderThemeTransition />
                </TransitionCollection>
            </ListView.ItemContainerTransitions>
            
            <ListView.ItemContainerStyle>
                 <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="0,0,0,8" />
                    <Setter Property="Margin" Value="0,4,0,4" />
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="u:ClipboardItem">
                    <Grid CornerRadius="12" 
                          Padding="12" 
                          BorderThickness="1"
                          BorderBrush="#11FFFFFF"
                          Background="{StaticResource GlassCardBackgroundBrush}">
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Spacing="4" VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind Preview}" 
                                       FontWeight="Medium"
                                       FontSize="14"
                                       MaxLines="2" 
                                       TextTrimming="CharacterEllipsis" 
                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8" Opacity="0.7">
                                <TextBlock Text="{x:Bind TimestampDisplay}" 
                                           FontSize="11" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                
                                <FontIcon Glyph="&#xE735;" FontFamily="Segoe MDL2 Assets" FontSize="12" 
                                          Foreground="{ThemeResource SystemAccentColor}"
                                          Visibility="{x:Bind IsPinned, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2" VerticalAlignment="Center" Margin="8,0,0,0">
                            <!-- Copy -->
                            <Button Click="CopyButton_Click" Tag="{x:Bind}" ToolTipService.ToolTip="Copy" Background="Transparent" BorderThickness="0">
                                <SymbolIcon Symbol="Copy" />
                            </Button>
                            
                            <!-- Toggle Pin -->
                            <ToggleButton Click="PinButton_Click" Tag="{x:Bind}" IsChecked="{x:Bind IsPinned, Mode=OneWay}" ToolTipService.ToolTip="Pin" Background="Transparent" BorderThickness="0">
                                <SymbolIcon Symbol="Pin" />
                            </ToggleButton>
                            
                            <!-- Delete -->
                            <Button Click="DeleteButton_Click" Tag="{x:Bind}" ToolTipService.ToolTip="Delete" Background="Transparent" BorderThickness="0">
                                <SymbolIcon Symbol="Delete" Foreground="Red"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        
        <ProgressRing Grid.Row="0" Grid.RowSpan="2" IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" 
                      HorizontalAlignment="Center" VerticalAlignment="Center" 
                      Width="40" Height="40" />
    </Grid>
</Page>
